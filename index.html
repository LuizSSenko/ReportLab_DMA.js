

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Geolocation Processor</title>
    
    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles_new.css">
</head>
<body>
    <!-- PAGE 1: Welcome Page -->
    <div id="welcomePage" class="page-container" style="display: block;">
        <div class="welcome-container">
            <header class="welcome-header">
                <h1>üìç Image Geolocation Processor</h1>
                <p>Process images with GPS data and correlate with map regions</p>
            </header>

            <main class="welcome-main">
                <div class="welcome-card">
                    <h2>üì∏ Upload Images</h2>
                    <div class="file-input-wrapper">
                        <input type="file" id="imageInput" accept="image/*" multiple>
                        <label for="imageInput" class="file-label">
                            <span class="file-icon">üìÅ</span>
                            Choose Images with GPS Data
                        </label>
                    </div>
                    <div class="file-info" id="imageInfo"></div>
                    
                    <div style="margin-top: 2rem;">
                        <h3>üó∫Ô∏è Map Data</h3>
                        <div class="file-info" id="geojsonInfo">Loading map.geojson...</div>
                        <div class="file-input-wrapper" style="margin-top: 1rem;">
                            <input type="file" id="geojsonInput" accept=".geojson,.json">
                            <label for="geojsonInput" class="file-label" style="background: #f7fafc; border: 1px solid #e2e8f0;">
                                <span class="file-icon">üìã</span>
                                Override with Custom GeoJSON
                            </label>
                        </div>
                    </div>
                    
                    <button id="processBtn" class="btn btn-primary" style="margin-top: 2rem; width: 100%;" disabled>
                        üöÄ Process Images
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- PAGE 2: Image Viewer -->
    <div id="viewerPage" class="page-container" style="display: none;">
        <header class="viewer-header">
            <div class="header-left">
                <button id="backButton" class="btn btn-back">‚Üê Back</button>
                <h1>üìç Image Analysis Results</h1>
            </div>
            <div class="header-right">
                <button id="configBtn" class="btn btn-secondary">
                    ‚öôÔ∏è Configura√ß√µes
                </button>
                <button id="generatePDF" class="btn btn-primary">
                    üìÑ Gerar PDF
                </button>
            </div>
        </header>

        <main class="viewer-main">
            <!-- Left Panel: Image List -->
            <div class="left-panel">
                <div class="panel-header">
                    <h3>üì∏ Images</h3>
                    <div class="selection-controls">
                        <button id="selectAllBtn" class="btn btn-small">Select All</button>
                        <button id="selectNoneBtn" class="btn btn-small">Select None</button>
                    </div>
                </div>
                <div class="image-list" id="imageList">
                    <!-- Image items will be dynamically populated -->
                </div>
            </div>

            <!-- Right Panel: Image Viewer -->
            <div class="right-panel">
                <div class="image-viewer">
                    <div class="image-display" id="imageDisplay">
                        <div class="placeholder" id="viewerPlaceholder">
                            <p>Select an image from the list to view details</p>
                        </div>
                        <img id="currentImage" style="display: none; max-width: 100%; max-height: 100%; object-fit: contain;">
                    </div>
                    <div class="image-details" id="imageDetails">
                        <!-- Image details will be populated here -->
                    </div>
                    
                    <!-- Image Location Map Container -->
                    <div id="imageMapContainer" class="image-map-container" style="display: none;">
                        <h4>üìç Image Location</h4>
                        <div id="imageMap" class="image-location-map" style="height: 250px; border-radius: 8px;"></div>
                    </div>
                </div>
                
                <!-- Map Section -->
                <div class="map-section">
                    <h3>üó∫Ô∏è Map View</h3>
                    <div id="map" style="height: 300px; border-radius: 8px;"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Generating PDF report...</div>
    </div>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configura√ß√µes</h2>
                <button id="closeModalBtn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-tabs">
                    <button class="tab-btn active" data-tab="pdf">üìÑ PDF</button>
                    <button class="tab-btn" data-tab="questionnaire">üìã Question√°rio</button>
                </div>
                
                <div class="tab-content active" id="pdfTab">
                    <div class="config-section">
                        <h3>üìã Configura√ß√£o da Capa</h3>
                        
                        <div class="form-group">
                            <label>Header 1:</label>
                            <input type="text" id="header1" value="DAV - DIRETORIA DE √ÅREAS VERDES / DMA - DIVIS√ÉO DE MEIO AMBIENTE">
                        </div>
                        
                        <div class="form-group">
                            <label>Header 2:</label>
                            <input type="text" id="header2" value="UNICAMP - UNIVERSIDADE ESTADUAL DE CAMPINAS">
                        </div>
                        
                        <div class="form-group">
                            <label>T√≠tulo:</label>
                            <input type="text" id="title" value="RELAT√ìRIO DE REALIZA√á√ÉO DE SERVI√áOS - PROVAC">
                        </div>
                        
                        <div class="form-group">
                            <label>Prefixo da Data:</label>
                            <input type="text" id="datePrefix" value="DATA DO RELAT√ìRIO:">
                        </div>
                        
                        <div class="form-group">
                            <label>N√∫mero de Refer√™ncia:</label>
                            <textarea id="referenceNumber">CONTRATO N¬∫: 039/2019 - PROVAC TERCEIRIZA√á√ÉO DE M√ÉO DE OBRA LTDA</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Descri√ß√£o:</label>
                            <textarea id="description">Vistoria de campo realizada pelos t√©cnicos da DAV.</textarea>
                        </div>
                        
                        <h3>üìç Informa√ß√µes de Rodap√©</h3>
                        
                        <div class="form-group">
                            <label>Endere√ßo:</label>
                            <input type="text" id="address" value="Rua 5 de Junho, 251 - Cidade Universit√°ria Zeferino Vaz - Campinas - SP">
                        </div>
                        
                        <div class="form-group">
                            <label>CEP:</label>
                            <input type="text" id="postalCode" value="13083-877">
                        </div>
                        
                        <div class="form-group">
                            <label>E-mail:</label>
                            <input type="text" id="contactPhone" value="mascard@unicamp.br">
                        </div>
                        
                        <div class="form-group">
                            <label>Assinatura 1:</label>
                            <input type="text" id="sign1" value="PREPOSTO CONTRATANTE">
                        </div>
                        
                        <div class="form-group">
                            <label>Nome Assinatura 1:</label>
                            <input type="text" id="sign1Name" value="">
                        </div>
                        
                        <div class="form-group">
                            <label>Assinatura 2:</label>
                            <input type="text" id="sign2" value="PREPOSTO CONTRATADA">
                        </div>
                        
                        <div class="form-group">
                            <label>Nome Assinatura 2:</label>
                            <input type="text" id="sign2Name" value="">
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h3>üîç Pr√©-visualiza√ß√£o da Capa</h3>
                        <div class="preview-container">
                            <div class="preview-page">
                                <div class="preview-page-content">
                                    <div class="preview-header">
                                        <div class="logo-placeholder logo-left">LOGO</div>
                                        <div class="logo-placeholder logo-right">LOGO</div>
                                        <h1 id="previewHeader1">DAV - DIRETORIA DE √ÅREAS VERDES / DMA - DIVIS√ÉO DE MEIO AMBIENTE</h1>
                                        <h2 id="previewHeader2">UNICAMP - UNIVERSIDADE ESTADUAL DE CAMPINAS</h2>
                                        <div class="preview-title" id="previewTitle">RELAT√ìRIO DE REALIZA√á√ÉO DE SERVI√áOS - PROVAC</div>
                                    </div>
                                    
                                    <div class="preview-content">
                                        <p><strong id="previewDatePrefix">DATA DO RELAT√ìRIO:</strong> <span id="previewDate"></span></p>
                                        <p id="previewReference">CONTRATO N¬∫: 039/2019 - PROVAC TERCEIRIZA√á√ÉO DE M√ÉO DE OBRA LTDA</p>
                                        <p id="previewDescription">Vistoria de campo realizada pelos t√©cnicos da DAV.</p>
                                    </div>
                                    
                                    <div class="preview-footer">
                                        <p id="previewAddress">Rua 5 de Junho, 251 - Cidade Universit√°ria Zeferino Vaz - Campinas - SP</p>
                                        <p>CEP: <span id="previewPostalCode">13083-877</span> - Tel: (19) 3521-7010 - Fax: (19) 3521-7635</p>
                                        <p id="previewContactPhone">mascard@unicamp.br</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h3>‚úçÔ∏è Pr√©-visualiza√ß√£o das Assinaturas</h3>
                        <div class="preview-container">
                            <div class="preview-page">
                                <div class="preview-page-content">
                                    <div class="signature-preview">
                                        <div class="signature-box">
                                            <h3 id="previewSign1">PREPOSTO CONTRATANTE</h3>
                                            <div class="signature-line"></div>
                                            <div class="signature-name" id="previewSign1Name">Nome</div>
                                            <div class="signature-date">Data: ......./......./...........</div>
                                        </div>
                                        <div class="signature-box">
                                            <h3 id="previewSign2">PREPOSTO CONTRATADA</h3>
                                            <div class="signature-line"></div>
                                            <div class="signature-name" id="previewSign2Name">Nome</div>
                                            <div class="signature-date">Data: ......./......./...........</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="questionnaireTab">
                    <div class="config-section">
                        <h3>üìã Configura√ß√µes do Question√°rio</h3>
                        <p>Configura√ß√µes do question√°rio ser√£o implementadas aqui.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelBtn" class="btn btn-secondary">Cancelar</button>
                <button id="saveConfigBtn" class="btn btn-primary">Salvar Configura√ß√µes</button>
            </div>
        </div>
    </div>

    <!-- CDN Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js@2.3.0/exif.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/imageProcessor.js"></script>
    <script src="js/mapManager.js"></script>
    <script src="js/pdfGenerator.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
